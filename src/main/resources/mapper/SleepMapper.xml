<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.example.monkey_server.dao.SleepDao">

    <select id="getSleepList" resultMap="sleepData">
        SELECT * FROM sleep s,user u WHERE uid = #{id} and s.uid=u.id
    </select>

    <insert id="insertSleepData" parameterType="com.example.monkey_server.entity.Sleep" useGeneratedKeys="true"
            keyProperty="id">
        insert sleep(uid,start_time,end_time,detail,grade) values (#{user.id},#{start_time},#{end_time},#{detail},#{grade})
    </insert>

    <select id="getSleepBean" resultMap="SleepBean">
        select * from sleep s where s.id = #{id}
    </select>

    <resultMap id="SleepBean" type="com.example.monkey_server.entity.Sleep">
        <id column="id" property="id"/>
        <result column="start_time" property="start_time"/>
        <result column="end_time" property="end_time"/>
        <result column="detail" property="detail"/>
        <result column="grade" property="grade"/>
        <association column="user" property="uid" select="com.example.monkey_server.dao.UserDao.selectUserById"/>
    </resultMap>

    <resultMap id="sleepData" type="com.example.monkey_server.bean.response.UserSleepBean">
        <result column="uid" property="uid"/>
        <result column="nickname" property="nickname"/>
        <collection property="sleepBeans" ofType="com.example.monkey_server.bean.response.SleepBean">
            <id column="id" property="id"/>
            <result column="start_time" property="start_time"/>
            <result column="end_time" property="end_time"/>
            <result column="detail" property="detail"/>
            <result column="grade" property="grade"/>
        </collection>
    </resultMap>


</mapper>